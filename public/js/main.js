var deckOfCards = [
  {
    cardType: 2,
    cardValue: 2,
    cardSuite: "Hearts",
    cardImage: "images/2_of_hearts.svg"
  },
  {
    cardType: 3,
    cardValue: 3,
    cardSuite: "Hearts",
    cardImage: "images/3_of_hearts.svg"
  },
  {
    cardType: 4,
    cardValue: 4,
    cardSuite: "Hearts",
    cardImage: "images/4_of_hearts.svg"
  },
  {
    cardType: 5,
    cardValue: 5,
    cardSuite: "Hearts",
    cardImage: "images/5_of_hearts.svg"
  },
  {
    cardType: 6,
    cardValue: 6,
    cardSuite: "Hearts",
    cardImage: "images/6_of_hearts.svg"
  },
  {
    cardType: 7,
    cardValue: 7,
    cardSuite: "Hearts",
    cardImage: "images/7_of_hearts.svg"
  },
  {
    cardType: 8,
    cardValue: 8,
    cardSuite: "Hearts",
    cardImage: "images/8_of_hearts.svg"
  },
  {
    cardType: 9,
    cardValue: 9,
    cardSuite: "Hearts",
    cardImage: "images/9_of_hearts.svg"
  },
  {
    cardType: 10,
    cardValue: 10,
    cardSuite: "Hearts",
    cardImage: "images/10_of_hearts.svg"
  },
  {
    cardType: "Jack",
    cardValue: 10,
    cardSuite: "Hearts",
    cardImage: "images/jack_of_hearts.svg"
  },
  {
    cardType: "Queen",
    cardValue: 10,
    cardSuite: "Hearts",
    cardImage:"images/queen_of_hearts.svg"
  },
  {
    cardType: "King",
    cardValue: 10,
    cardSuite: "Hearts",
    cardImage:"images/king_of_hearts.svg"
  },
  {
    cardType: "Ace",
    cardValue: 11,
    cardSuite: "Hearts",
    cardImage: "images/ace_of_hearts.svg"
  },
  {
    cardType: 2,
    cardValue: 2,
    cardSuite: "Diamonds",
    cardImage: "images/2_of_diamonds.svg"
  },
  {
    cardType: 3,
    cardValue: 3,
    cardSuite: "Diamonds",
    cardImage:"images/3_of_diamonds.svg"
  },
  {
    cardType: 4,
    cardValue: 4,
    cardSuite: "Diamonds",
    cardImage:"images/4_of_diamonds.svg"
  },
  {
    cardType: 5,
    cardValue: 5,
    cardSuite: "Diamonds",
    cardImage:"images/5_of_diamonds.svg"
  },
  {
    cardType: 6,
    cardValue: 6,
    cardSuite: "Diamonds",
    cardImage:"images/6_of_diamonds.svg"
  },
  {
    cardType: 7,
    cardValue: 7,
    cardSuite: "Diamonds",
    cardImage: "images/7_of_diamonds.svg"
  },
  {
    cardType: 8,
    cardValue: 8,
    cardSuite: "Diamonds",
    cardImage: "images/8_of_diamonds.svg"
  },
  {
    cardType: 9,
    cardValue: 9,
    cardSuite: "Diamonds",
    cardImage: "images/9_of_diamonds.svg"
  },
  {
    cardType: 10,
    cardValue: 10,
    cardSuite: "Diamonds",
    cardImage: "images/10_of_diamonds.svg"
  },
  {
    cardType: "Jack",
    cardValue: 10,
    cardSuite: "Diamonds",
    cardImage: "images/jack_of_diamonds.svg"
  },
  {
    cardType: "Queen",
    cardValue: 10,
    cardSuite: "Diamonds",
    cardImage: "images/queen_of_diamonds.svg"
  },
  {
    cardType: "King",
    cardValue: 10,
    cardSuite: "Diamonds",
    cardImage: "images/king_of_diamonds.svg"
  },
  {
    cardType: "Ace",
    cardValue: 11,
    cardSuite: "Diamonds",
    cardImage: "images/ace_of_diamonds.svg"
  },
  {
    cardType: 2,
    cardValue: 2,
    cardSuite: "Clubs",
    cardImage: "images/2_of_clubs.svg"
  },
  {
    cardType: 3,
    cardValue: 3,
    cardSuite: "Clubs",
    cardImage: "images/3_of_clubs.svg"
  },
  {
    cardType: 4,
    cardValue: 4,
    cardSuite: "Clubs",
    cardImage: "images/4_of_clubs.svg"
  },
  {
    cardType: 5,
    cardValue: 5,
    cardSuite: "Clubs",
    cardImage: "images/5_of_clubs.svg"
  },
  {
    cardType: 6,
    cardValue: 6,
    cardSuite: "Clubs",
    cardImage: "images/6_of_clubs.svg"
  },
  {
    cardType: 7,
    cardValue: 7,
    cardSuite: "Clubs",
    cardImage: "images/7_of_clubs.svg"
  },
  {
    cardType: 8,
    cardValue: 8,
    cardSuite: "Clubs",
    cardImage: "images/8_of_clubs.svg"
  },
  {
    cardType: 9,
    cardValue: 9,
    cardSuite: "Clubs",
    cardImage: "images/9_of_clubs.svg"
  },
  {
    cardType: 10,
    cardValue: 10,
    cardSuite: "Clubs",
    cardImage: "images/10_of_clubs.svg"
  },
  {
    cardType: "Jack",
    cardValue: 10,
    cardSuite: "Clubs",
    cardImage: "images/jack_of_clubs.svg"
  },
  {
    cardType: "Queen",
    cardValue: 10,
    cardSuite: "Clubs",
    cardImage: "images/queen_of_clubs.svg"
  },
  {
    cardType: "King",
    cardValue: 10,
    cardSuite: "Clubs",
    cardImage: "images/king_of_clubs.svg"
  },
  {
    cardType: "Ace",
    cardValue: 11,
    cardSuite: "Clubs",
    cardImage: "images/ace_of_clubs.svg"
  },
  {
    cardType: 2,
    cardValue: 2,
    cardSuite: "Spades",
    cardImage: "images/2_of_spades.svg"
  },
  {
    cardType: 3,
    cardValue: 3,
    cardSuite: "Spades",
    cardImage: "images/3_of_spades.svg"
  },
  {
    cardType: 4,
    cardValue: 4,
    cardSuite: "Spades",
    cardImage: "images/4_of_spades.svg"
  },
  {
    cardType: 5,
    cardValue: 5,
    cardSuite: "Spades",
    cardImage: "images/5_of_spades.svg"
  },
  {
    cardType: 6,
    cardValue: 6,
    cardSuite: "Spades",
    cardImage: "images/6_of_spades.svg"
  },
  {
    cardType: 7,
    cardValue: 7,
    cardSuite: "Spades",
    cardImage: "images/7_of_spades.svg"
  },
  {
    cardType: 8,
    cardValue: 8,
    cardSuite: "Spades",
    cardImage: "images/8_of_spades.svg"
  },
  {
    cardType: 9,
    cardValue: 9,
    cardSuite: "Spades",
    cardImage: "images/9_of_spades.svg"
  },
  {
    cardType: 10,
    cardValue: 10,
    cardSuite: "Spades",
    cardImage: "images/10_of_spades.svg"
  },
  {
    cardType: "Jack",
    cardValue: 10,
    cardSuite: "Spades",
    cardImage: "images/jack_of_spades.svg"
  },
  {
    cardType: "Queen",
    cardValue: 10,
    cardSuite: "Spades",
    cardImage: "images/queen_of_spades.svg"
  },
  {
    cardType: "King",
    cardValue: 10,
    cardSuite: "Spades",
    cardImage: "images/king_of_spades.svg"
  },
  {
    cardType: "Ace",
    cardValue: 11,
    cardSuite: "Spades",
    cardImage: "images/ace_of_spades.svg"
  }
];

var Betting = {
  playerScore: 1000,
  playerBet: 100,
  playerWin: function(multiplier){
    Betting.playerScore += (Betting.playerBet * multiplier);
    $('#credits').html(Betting.playerScore);
    BlackJack.gameDealt = false;
  },
  playerLose: function(){
    Betting.playerScore -= Betting.playerBet;
    $('#credits').html(Betting.playerScore);
    if (Betting.playerScore < Betting.playerBet) {
      Betting.playerBet = Betting.playerScore;
      $('#currentbet').html(Betting.playerBet);
    }
    if (Betting.playerScore <= 0) {
      setTimeout(function(){ alert("You are all out of credits! I'll loan you $1000 more, better luck this time!");}, 750);
      Betting.playerScore = 1000;
      Betting.playerBet = 100;
      $('#credits').html(Betting.playerScore);
      $('#currentbet').html(Betting.playerBet);
    }
    BlackJack.gameDealt = false;
  },
  add100: function(){
    if (Betting.playerBet < Betting.playerScore) {
      Betting.playerBet += 100;
      $('#currentbet').html(Betting.playerBet);
    }
  },
  subtract100: function() {
    if (Betting.playerBet > 0) {
      Betting.playerBet -= 100;
      $('#currentbet').html(Betting.playerBet);
    }
  }
};
var BlackJack = {
  userRandomCards: [],
  userCardValues: [],
  userHand: 0,
  dealerRandomCards: [],
  dealerCardValues: [],
  dealerHand: 0,
  gameDealt: false,
  dealerStage: false,
  showDealerCard: function(){
    var firstCardImage = BlackJack.dealerRandomCards[0].cardImage;
    if (BlackJack.dealerStage === false) {
      $("[data-dealer="+"0"+"]").html(`<img class='card' src='images/fillmurray.jpg'/>`);
    }
    if (BlackJack.dealerStage === true) {
      $("[data-dealer="+"0"+"]").html(`<img class='card' src='${BlackJack.dealerRandomCards[0].cardImage}'/>`);
    }
  },
  dealHand: function(){
    BlackJack.reset();
    console.log("Hand Dealt!");
    BlackJack.gameDealt = true;
    AppHelpers.getRandomCard();
    AppHelpers.getRandomCard();
    BlackJack.dealerStage = true;
    AppHelpers.getRandomCard();
    AppHelpers.getRandomCard();
    BlackJack.dealerStage = false;
    AppHelpers.displayUserScore();
    BlackJack.showDealerCard();
    BlackJack.checkForBlackJack();

  },
  hit: function(){
    AppHelpers.getRandomCard();
    BlackJack.checkForWin();
    AppHelpers.displayUserScore();
  },
  stand: function(){
    BlackJack.dealerStage = true;
    BlackJack.showDealerCard();
    BlackJack.checkForWin();
    while (BlackJack.dealerHand < 17) {
      setTimeout(AppHelpers.getRandomCard(), 1000);
      BlackJack.checkForWin();
    }
  },
  checkForBlackJack: function(){
    if (BlackJack.userHand === 21) {
      BlackJack.dealerStage = true;
      BlackJack.showDealerCard();
      setTimeout(function(){ alert("BlackJack! You Win!"); }, 500);
      Betting.playerWin(1.5);
    } else if (BlackJack.dealerHand === 21) {
      BlackJack.dealerStage = true;
      BlackJack.showDealerCard();
      setTimeout(function(){ alert("Dealer has BlackJack, you lose."); }, 500);
      Betting.playerLose();
    }
  },
  checkForWin: function() {
    if (BlackJack.dealerStage === true) {
      if (BlackJack.userHand > BlackJack.dealerHand && BlackJack.userHand < 22 && BlackJack.dealerHand > 16) {
        setTimeout(function(){ alert("You Win! Your Score:" + BlackJack.userHand + " Dealer Score:" + BlackJack.dealerHand); }, 500);
        Betting.playerWin(1);
      } else if (BlackJack.dealerHand > BlackJack.userHand && BlackJack.dealerHand > 16 && BlackJack.dealerHand < 22 && BlackJack.dealerStage === true) {
        setTimeout(function(){ alert("You Lose. Your Score:" + BlackJack.userHand + " Dealer Score:" + BlackJack.dealerHand); }, 500);
        Betting.playerLose();
      } else if (BlackJack.dealerHand === BlackJack.userHand && BlackJack.dealerHand > 16) {
        setTimeout(function(){ alert("Push. Your Score:" + BlackJack.userHand + " Dealer Score:" + BlackJack.dealerHand); }, 500);
        BlackJack.gameDealt = false;
      }
    }
    if (BlackJack.userHand > 21) {
      setTimeout(function(){alert("Busted! You lose. Your Score:" + BlackJack.userHand + " Dealer Score:" + BlackJack.dealerHand); }, 500);
      Betting.playerLose();
    } else if(BlackJack.dealerHand > 21 && BlackJack.userHand < 22){
      setTimeout(function(){ alert("Dealer busted, you win! Your Score:" + BlackJack.userHand + " Dealer Score:" + BlackJack.dealerHand); }, 500);
      Betting.playerWin(1);
    }

  },
  reset: function(){
    BlackJack.userHand = 0;
    BlackJack.userRandomCards = [];
    BlackJack.userCardValues = [];
    BlackJack.dealerHand = 0;
    BlackJack.dealerRandomCards = [];
    BlackJack.dealerCardValues = [];
    BlackJack.gameDealt = false;
    BlackJack.dealerStage = false;
    AppHelpers.displayUserScore();
    $("#dealercards").empty();
    $("#usercards").empty();
  }

};
var AppHelpers = {
  getRandomCard: function(){
    var randomNumber = Math.floor(Math.random() * 52);
    var randomCard = deckOfCards[randomNumber];
    if (BlackJack.dealerStage === false) {
      BlackJack.userRandomCards.push(randomCard);
      BlackJack.userCardValues.push(randomCard.cardValue);
      BlackJack.userHand = 0;
      for (var i = 0; i < BlackJack.userCardValues.length; i++) {
        BlackJack.userHand += BlackJack.userCardValues[i];
        if(BlackJack.userHand > 21){
          for (var j = 0; j < BlackJack.userCardValues.length; j++) {
            if (BlackJack.userCardValues[j] === 11 && BlackJack.userHand > 21) {
            BlackJack.userHand -= BlackJack.userCardValues[j];
            BlackJack.userCardValues[j] = 1;
            BlackJack.userHand += BlackJack.userCardValues[j];
            return;
            }
          }
        }
      }
      var newCard = $('<span>');
      newCard.addClass("cards");
      newCard.attr("data-user", BlackJack.userRandomCards.length - 1);
      newCard.html(`<img class='card' src='${randomCard.cardImage}'/>`);
      $('#usercards').append(newCard);
    } else if (BlackJack.dealerStage === true) {
      BlackJack.dealerRandomCards.push(randomCard);
      BlackJack.dealerCardValues.push(randomCard.cardValue);
      BlackJack.dealerHand = 0;
      for (var i = 0; i < BlackJack.dealerCardValues.length; i++) {
        BlackJack.dealerHand += BlackJack.dealerCardValues[i];
        if(BlackJack.dealerHand > 21){
          for (var j = 0; j < BlackJack.dealerCardValues.length; j++) {
            if (BlackJack.dealerCardValues[j] === 11 && BlackJack.dealerHand > 21) {
            BlackJack.dealerHand -= BlackJack.dealerCardValues[j];
            BlackJack.dealerCardValues[j] = 1;
            BlackJack.dealerHand += BlackJack.dealerCardValues[j];
            }
          }
        }
      }
      var newCard = $('<span>');
      newCard.addClass("cards");
      newCard.attr("data-dealer", BlackJack.dealerRandomCards.length - 1);
      newCard.html(`<img class='card' src='${randomCard.cardImage}'/>`);
      $('#dealercards').append(newCard);
    }
  },
  displayUserScore: function(){
     $('#userscore').html(BlackJack.userHand);
  }
};

var AppController = {
  handleDeal: function(){
    if(BlackJack.gameDealt === false){
      BlackJack.gameDealt = true;
      BlackJack.dealHand();
    }
  },
  handleHit: function(){
    if (BlackJack.gameDealt === true && BlackJack.dealerStage === false) {
      BlackJack.hit();
    }
  },
  handleStand: function(){
    if (BlackJack.gameDealt === true && BlackJack.dealerStage === false) {
      BlackJack.stand();
    }
  },
  handleReset: function(){
    console.log("Reset works");
    BlackJack.reset();
  },
  handleAdd: function(){
    console.log("addition works");
    if (BlackJack.gameDealt === false) {
      Betting.add100();
    }
  },
  handleSubtract: function(){
    console.log("subtraction works");
    if (BlackJack.gameDealt === false) {
      Betting.subtract100();
    }
  }
};

window.onload = function(){
  $('#deal_button').on('click', function(){
    AppController.handleDeal();
  });
  $('#hit_button').on('click', function(){
    AppController.handleHit();
  });
  $('#stand_button').on('click', function(){
    AppController.handleStand();
  });
  $('#reset_button').on('click', function(){
    AppController.handleReset();
  });
  $('#add100_button').on('click', function(){
    AppController.handleAdd();
  });
  $('#subtract100_button').on('click', function(){
    AppController.handleSubtract();
  });
};
